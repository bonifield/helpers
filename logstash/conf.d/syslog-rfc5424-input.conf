# manual testing with https://github.com/bonifield/helpers/raw/master/python/python-syslog3-rfc5424.py
#	sudo /usr/share/logstash/bin/logstash -f /etc/logstash/conf.d/syslog-rfc5424-input.conf --config.test_and_exit
#	sudo /usr/share/logstash/bin/logstash -f /etc/logstash/conf.d/syslog-rfc5424-input.conf --config.reload.automatic
#	python3 python-syslog3-rfc5424.py 127.0.0.1 514

input {
	syslog {
		port => 514
		ecs_compatibility => "v1"
	}
}

filter {
	mutate {
		gsub => ["message", "\u0000", ""]
	}
	grok {
		match => { "message" => "%{POSINT:[process][id]} %{DATA:[log][syslog][msgid]} \[%{DATA:[log][syslog][structured_data]}\] %{GREEDYDATA:[log][syslog][message]}"}
	}
	kv {
		source => "[log][syslog][structured_data]"
	}
	#
	# do something with the parsed fields
	#
	mutate {
		remove_field => ["[log][syslog][structured_data]", "message"]
	}
}

output {
	stdout { codec => rubydebug }
}
