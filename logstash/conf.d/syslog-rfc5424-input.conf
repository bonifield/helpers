input {
	syslog {
		port => 514
		ecs_compatibility => "v1"
	}
}

filter {
	mutate {
		gsub => ["message", "\u0000", ""]
	}
	grok {
		match => { "message" => "%{POSINT:[process][id]} %{DATA:[log][syslog][msgid]} \[%{DATA:[log][syslog][structured_data]}\] %{GREEDYDATA:[log][syslog][message]}"}
	}
	kv {
		source => "[log][syslog][structured_data]"
	}
	#
	# do something with the parsed fields
	#
	mutate {
		remove_field => [ "[log][syslog][structured_data]", "message" ]
	}
}

output {
	stdout { codec => rubydebug }
}
